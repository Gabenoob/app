#include <stdio.h>
#include "oled.h"
#include "gui.h"
#include "light.h"
#include "motor.h"
unsigned int lastCount;
int mode = 1;
int flg = 0;

// 16*16/8
//  #define FONT_SIZE 32 //32 = 16*16/8
//  unsigned char  font_array[][FONT_SIZE]={

// screen_size 128*64

/*size 100*42 */
const unsigned char logo[] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xed, 0x6f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0xbb, 0xda, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x07, 0xef, 0xff, 0xb0, 0x7f, 0xff, 0xff, 0xfd, 0xc3, 0x7f, 0x6d, 0xc3, 0x3f, 0xff, 0xff, 0xff, 0x73, 0xfd, 0xff, 0x6f, 0xdf, 0xff, 0xff, 0xff, 0xfb, 0xf7, 0xfd, 0xca, 0xff, 0xff, 0xff, 0xfd, 0x6b, 0xdf, 0xdf, 0xdf, 0xff, 0xff, 0xff, 0xfb, 0xfd, 0xff, 0xfb, 0xdd, 0x7f, 0xff, 0xff, 0xf7, 0xff, 0xfe, 0xff, 0xff, 0xaf, 0xff, 0xff, 0xef, 0x7f, 0xfb, 0xde, 0xed, 0xff, 0xff, 0xff, 0xfd, 0xef, 0x6f, 0xfb, 0xff, 0xaf, 0xff, 0xff, 0xaf, 0xff, 0xff, 0xff, 0x7f, 0xfb, 0xff, 0xff, 0x8f, 0xff, 0xff, 0x6e, 0x1f, 0xff, 0xff, 0xff, 0x07, 0xff, 0xff, 0xfe, 0x1f, 0xff, 0xff, 0xff, 0x2f, 0xff, 0xfb, 0xfe, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0xfd, 0xff, 0xff, 0xfe, 0xff, 0xfb, 0xdf, 0xed, 0xf7, 0xaa, 0xbf, 0xfd, 0xdb, 0x6f, 0xfd, 0xff, 0xdf, 0x7f, 0xff, 0xff, 0x7f, 0xff, 0xff, 0xff, 0x7d, 0xd5, 0x7f, 0xfb, 0xeb, 0x7f, 0x77, 0xb7, 0xf7, 0x7e, 0xbf, 0xfd, 0x7d, 0xfd, 0xff, 0xfe, 0xfd, 0xd7, 0xdf, 0xff, 0xd7, 0xdf, 0xfe, 0xfb, 0xd7, 0x7a, 0xbf, 0xf5, 0x7e, 0xff, 0xdb, 0xdf, 0xff, 0xdf, 0x7f, 0xff, 0xef, 0xf6, 0xff, 0xff, 0x7a, 0xea, 0xdf, 0xfa, 0xff, 0xbf, 0xff, 0xf7, 0xef, 0xbf, 0xbf, 0xff, 0xbb, 0xff, 0xee, 0xde, 0xfe, 0xea, 0xdf, 0xf5, 0xfe, 0xf7, 0x7f, 0xff, 0xdb, 0xdf, 0x6f, 0xff, 0x6f, 0xdf, 0xfb, 0xf7, 0x7f, 0x75, 0xbf, 0xf5, 0xfd, 0xfe, 0xef, 0x7f, 0xf6, 0xde, 0xdf, 0xff, 0x5f, 0xfb, 0xff, 0xdb, 0x7f, 0xeb, 0x6f, 0xfb, 0xdb, 0x6f, 0xbd, 0xff, 0xd5, 0x76, 0xdf, 0xfd, 0x5f, 0xff, 0xf7, 0xdd, 0xff, 0xad, 0xbf, 0xfb, 0xdd, 0xbb, 0x7f, 0x77, 0x55, 0x6b, 0xdf, 0xfe, 0xef, 0xef, 0xdd, 0xff, 0xff, 0xce, 0xbf, 0xfb, 0xaa, 0xfd, 0xf7, 0xb5, 0x55, 0x5b, 0x6f, 0xfe, 0xe7, 0xaf, 0x7e, 0xff, 0xff, 0x9d, 0xbf, 0xfd, 0xb3, 0xfb, 0xd7, 0xab, 0x55, 0x77, 0x7f, 0xff, 0x79, 0x5e, 0xfd, 0xfe, 0xfe, 0x3a, 0xbf, 0xff, 0xdc, 0xf7, 0x5b, 0x6d, 0xd4, 0xef, 0x7f, 0xfe, 0xbe, 0x7b, 0xff, 0xf7, 0x79, 0xb5, 0xff, 0xff, 0xeb, 0x1e, 0xd5, 0x5f, 0xd3, 0x7d, 0x7f, 0xff, 0x5f, 0x87, 0xbf, 0xfa, 0xa6, 0xd5, 0xff, 0xff, 0xf5, 0xe0, 0xf6, 0xde, 0x0d, 0xeb, 0xff, 0xff, 0xde, 0xb8, 0x1b, 0x60, 0xbf, 0x5d, 0xff, 0xff, 0xeb, 0xee, 0x80, 0x02, 0xf5, 0xe7, 0xff, 0xff, 0xfd, 0xbf, 0xe9, 0x5f, 0xde, 0xbf, 0xff, 0xff, 0xf6, 0xea, 0xff, 0xfb, 0x77, 0xab, 0xff, 0xff, 0xff, 0x7f, 0xae, 0xde, 0xda, 0xbf, 0xff, 0xff, 0xfd, 0xab, 0x7b, 0xeb, 0xee, 0xbf, 0xff, 0xff, 0xff, 0xdd, 0xde, 0xbe, 0xb9, 0xff, 0xff, 0xff, 0xff, 0x77, 0x77, 0xeb, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xdb, 0xba, 0xbd, 0x57, 0xff, 0xff, 0xfb, 0xff, 0xfd, 0x6f, 0xd6, 0xbf, 0xff, 0xff, 0x7f, 0xff, 0xff, 0xa9, 0x5b, 0x77, 0xff, 0xff, 0xff, 0xff, 0xfd, 0xfe, 0xb5, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdb, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};
static GpioIsrCallbackFunc OnButtonPress(char *arg)
{
    (void)arg;
    unsigned int tickCount = osKernelGetTickCount();
    unsigned int count = tickCount - lastCount;
    lastCount = tickCount;
    if (count < 50)
    {
        return;
    }
    if (mode == 4)
        mode = 1;
    else
        mode++;
    flg = 1;
}

void test_led_screen(void)
{

    printf("before oled clear \r\n");
    OLED_Init(); // 初始化OLED
    OLED_Clear(0);
    IoTGpioRegisterIsrFunc(Button, IOT_INT_TYPE_EDGE, IOT_GPIO_EDGE_FALL_LEVEL_LOW, OnButtonPress, NULL);
    int flag = 1;
    while (1)
    {
        if (mode == 4)
        {
            OLED_Clear(0);
            GUI_ShowString(39, 23, "LED", 16, 1);
            OLED_Display();
            flag = 0;
        }
        else if (flag != 1)
        {
            OLED_Init();
            flag = 1;
        }
        extern int freq;
        extern int value;
        if (mode == 1)
        {
            extern float g_temp;
            OLED_Clear(0);
            char buf1[30];
            sprintf(buf1, "%.5f", g_temp);
            GUI_ShowChinese(0, 0, 24, "温度", 1);
            GUI_ShowString(0, 30, buf1, 16, 1);
            OLED_Display();
        }
        else if (mode == 2)
        {
            extern float g_humi;
            OLED_Clear(0);
            char buf1[30];
            sprintf(buf1, "%.5f%%", g_humi);
            GUI_ShowChinese(0, 0, 24, "湿度", 1);
            GUI_ShowString(0, 30, buf1, 16, 1);
            OLED_Display();
        }
        else if (mode == 3)
        {

            char *str1 = "speed";
            char *str2 = "freq";
            char buf1[30];
            sprintf(buf1, "%s:%d", str1, value);
            OLED_Clear(0);
            GUI_ShowString(0, 0, buf1, 16, 1);
            sprintf(buf1, "%s:%d", str2, freq);
            GUI_ShowString(0, 16, buf1, 16, 1);
            OLED_Display();
        }
        if (flg)
        {
            value = 0;
            freq = 20000;
            motor_speed(value, freq);
            flg = 0;
        }
        sleep(1);
    }
}
